<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page - Image Sorting</title>
    <style>
        .image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .image-wrapper {
            display: inline-block;
            position: relative;
        }
        .image-wrapper img {
            width: 100px;
            height: 100px;
            object-fit: cover;
        }
        .image-wrapper.dragging {
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <h1>Manage Images</h1>

    <div id="imageContainer" class="image-container"></div>
    <button id="saveOrderBtn">Save Order</button>

    <script>
        let draggedItem = null;
        const imageContainer = document.getElementById("imageContainer");

        // Fetch and display the images
        function loadImages() {
            fetch("/images")
                .then(response => response.json())
                .then(data => {
                    imageContainer.innerHTML = "";
                    data.forEach((imgPath, index) => {
                        const imgElement = document.createElement("img");
                        imgElement.src = imgPath;
                        imgElement.draggable = true;  // Make images draggable
                        imgElement.dataset.index = index;  // Store image index

                        const wrapper = document.createElement("div");
                        wrapper.className = "image-wrapper";
                        wrapper.appendChild(imgElement);

                        wrapper.addEventListener("dragstart", dragStart);
                        wrapper.addEventListener("dragover", dragOver);
                        wrapper.addEventListener("drop", drop);
                        wrapper.addEventListener("dragend", dragEnd);

                        imageContainer.appendChild(wrapper);
                    });
                });
        }

        function dragStart(e) {
            draggedItem = this;
            setTimeout(() => {
                this.classList.add("dragging");
            }, 0);
        }

        function dragEnd() {
            this.classList.remove("dragging");
            draggedItem = null;
        }

        function dragOver(e) {
            e.preventDefault();
            const draggingOverItem = this;
            if (draggedItem !== draggingOverItem) {
                const allItems = Array.from(imageContainer.children);
                const draggingIndex = allItems.indexOf(draggedItem);
                const overIndex = allItems.indexOf(draggingOverItem);
                if (draggingIndex < overIndex) {
                    imageContainer.insertBefore(draggedItem, draggingOverItem.nextSibling);
                } else {
                    imageContainer.insertBefore(draggedItem, draggingOverItem);
                }
            }
        }

        function drop() {
            // Handle the drop
        }

        // Save the new order of images
        document.getElementById("saveOrderBtn").addEventListener("click", () => {
            const newOrder = Array.from(imageContainer.children).map(wrapper => {
                const imgElement = wrapper.querySelector("img");
                return imgElement.src;
            });

            fetch("/save-order", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ order: newOrder })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Image order saved successfully!");
                } else {
                    alert("Failed to save image order.");
                }
            });
        });

        // Load images when the page loads
        window.onload = loadImages;
    </script>
</body>
</html>
